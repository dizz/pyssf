.. 
   Copyright (C) 2010 Platform Computing
   
   This library is free software; you can redistribute it and/or
   modify it under the terms of the GNU Lesser General Public
   License as published by the Free Software Foundation; either
   version 2.1 of the License, or (at your option) any later version.
   
   This library is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
   Lesser General Public License for more details.
   
   You should have received a copy of the GNU Lesser General Public
   License along with this library; if not, write to the Free Software
   Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
   

Examples of how to use SSF
==========================
The following examples demonstrate how the SSF modules can be used individually
or in conjunction. These examples just demonstrate how SSF can be used in
different setups. The examples are for demonstration purposes only - they do
not strive to be complete or perfectly pythonic.

Using the pyrest module (job submission)
----------------------------------------
The following sections describe some possible use case setups for the pyrest
module. All use the default ResourceHandler, Storage and Backend and therefore
feature only job submissions.

Using pyrest without SSL or authentication
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
The following code demonstrates how to setup pyrest in the easiest possible
way::

    from pyrest import service
    from pyrest.service import ResourceHandler
    import web
    
    # setup the service
    urls = ('/(.*)', 'ResourceHandler')
    web.config.debug = False
    application = web.application(urls, globals())
    
    # run...
    if __name__ == "__main__":
        application.run()

Using pyrest with SSL and basic Authentication
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
The following code can be used to realize a RESTful interface for job
submission using the pyrest module. It uses the internal CherryPy web server::

    from pyrest import service, myexceptions
    from pyrest.service import ResourceHandler
    from pyrest.service import SecurityHandler
    import web
    
    # setup the service
    urls = ('/(.*)', 'ResourceHandler')
    web.config.debug = False
    application = web.application(urls, globals())
    
    # enable SSL
    from web.wsgiserver import CherryPyWSGIServer
    CherryPyWSGIServer.ssl_certificate = "<path to ca>/newcert.pem"
    CherryPyWSGIServer.ssl_private_key = "<path to ca>/newkey.pem"
    
    # create a very simple security handler
    class SimpleSecurityHandler(SecurityHandler):
        
        def authenticate(self, username, password):
            if username == 'foo' and password == 'bar':
                pass
            else:
                raise myexceptions.SecurityException()
    
    # activate authentication
    service.authentication_enabled = True
    service.security_handler = SimpleSecurityHandler()
    
    # run...
    if __name__ == "__main__":
        application.run()

Using pyrest in a PKI secured environment
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
This example assumes that you have deployed pyrest using mod_wsgi on Apache. To
use pyrest in this setup use the following script (which is configures in your
Apache site configuration)::

    from pyrest import service
    from pyrest.service import ResourceHandler
    import web
    
    # setup the service
    urls = ('/(.*)', 'ResourceHandler')
    web.config.debug = False
    application = web.application(urls, globals()).wsgifunc()

.. note::
    See the slightly different application assigment with the wsgifunc() call
    added. Also note that no security feature need to be enabled, since Apache
    handles those.

Clients for pyrest (job submission)
-----------------------------------

A simple pyrest client (without SSL or authentication)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Now you can access the RESTful service from basically everywhere using anything
. For example you can use your web browser or use the python httplib2 package.
Other programming languages have similar libraries: libcurl for C,
URLConnection for Java, etc. This is transparent to the user and no
knowledge/API/proprietary interface to the underlying systems needs to be
provided/used.

A simple python program to submit a job would look like::

    import httplib2
    h = httplib2.Http()
    
    # create HTTP headers with the right category (mandatory field ) and attributes
    heads = {'Category': 'job;scheme="http://schemas.ogf.org/occi/drmaa#";label="Job Resource"', 
             'Attribute': 'occi.drmaa.remote_command=/bin/sleep, occi.drmaa.args=10'}
    response = h.request('http://localhost:8080/','POST', headers=heads)
    
    # get the URL of the newly created resource...
    url = str(response)[str(response).find('location') + 12:]
    url = 'http://localhost:8080' + url[:url.find(',') - 1]
    
    # and delete it
    h.request(url,'DELETE')

A pyrest client using SSL and basic authentication
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
A simple client which corresponds to the setup described above::

    import httplib
    import base64
    import string
    
    heads = {'Category': 'job;scheme="http://schemas.ogf.org/occi/drmaa#"',
             'Attribute': 'occi.drmaa.remote_command=/bin/sleep, occi.drmaa.args=10',
             'Authorization': 'Basic ' + string.strip(base64.encodestring('foo' + ':' + 'bar')) }
    
    # setup SSL connection
    conn = httplib.HTTPSConnection('localhost', 8080)
    
    # create a resource
    conn.request("POST", "/", headers = heads)
    r1 = conn.getresponse()
    url = r1.getheader('Location')
    print r1.status, r1.reason, r1.getheader('Location'), r1.read()
    
    # and get it
    conn.request("GET", url, headers={'Authorization': 'Basic ' + string.strip(base64.encodestring('foo' + ':' + 'bar'))})
    r2 = conn.getresponse()
    print r2.status, r2.reason, r2.getheaders(), r2.read()
    
    conn.close()

A pyrest client which uses X590 certificates
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
This is a simple client using the httplib library::

    import httplib
    
    KEYFILE = '<path to key>/newkey.pem'
    CERTFILE = '<path to cert>/newcert.pem'
    heads = {'Category': 'job;scheme="http://schemas.ogf.org/occi/drmaa#"',
             'Attribute': 'occi.drmaa.remote_command=/bin/sleep, occi.drmaa.args=10'}
    
    # create a PKI secured connection
    conn = httplib.HTTPSConnection('localhost', 81, key_file = KEYFILE, cert_file = CERTFILE)
    
    # create a resource
    conn.request("POST", "/", headers = heads)
    r1 = conn.getresponse()
    url = r1.getheader('Location')
    print r1.status, r1.reason, r1.getheader('Location'), r1.read()
    
    # and get the resource
    conn.request("GET", url)
    r2 = conn.getresponse()
    print r2.status, r2.reason, r2.getheaders(), r2.read()
    
    conn.close()

Using the pyrest module (customized backend)
--------------------------------------------
The following code examples demonstrates how to configure the ResourceHandler
to use a different backend. The backend described here will uses VirtualBox. So
the pyrest module basically becomes a RESTful Cloud Computing interface for
Virtual Machine management (IaaS).
